@model DataSync.Web.Models.ViewModels.ProjectDetailsVm
@{
    ViewData["Title"] = "Issue Details";
    var activeTab = (ViewData["ActiveTab"] as string) ?? "IssueDetails";
}

<!-- =========================
   PROJECT HERO (Same as Details)
========================== -->
<div class="project-hero">
    <div class="hero-left">
        <div class="hero-logo" aria-hidden="true">
            @(string.IsNullOrWhiteSpace(Model.ClientName)
                ? "C"
                : Model.ClientName.Trim().Substring(0, 1).ToUpperInvariant())
        </div>

        <div class="hero-text">
            <div class="hero-topline">
                <a class="crumb-link" asp-controller="Projects" asp-action="Index">Projects</a>
                <span class="crumb-sep">/</span>
                <span class="crumb-current">@Model.Name</span>
            </div>

            <div class="hero-title-row">
                <h1 class="hero-title">@Model.Name</h1>

                <div class="hero-badges">
                    <span class="pill pill-status">@Model.Status</span>
                    <span class="pill pill-health">@Model.Health</span>
                    <span class="pill pill-env">@Model.Environment</span>
                </div>
            </div>

            <div class="hero-meta">
                <span><strong>Client:</strong> @Model.ClientName</span>
                <span class="subdot">•</span>
                <span><strong>Source:</strong> @Model.SourcePlatform</span>
                <span class="subdot">•</span>
                <span><strong>Target:</strong> @Model.TargetPlatform</span>
                <span class="subdot">•</span>
                <span><strong>Owner:</strong> @Model.Owner</span>
            </div>
        </div>
    </div>

    <div class="hero-right">
        <button class="btn btn-secondary" type="button">
            <i data-lucide="download"></i>
            Export
        </button>

        <button class="btn btn-secondary" type="button">
            <i data-lucide="settings"></i>
            Settings
        </button>

        <button class="btn btn-primary" type="button">
            <i data-lucide="play"></i>
            Run Now
        </button>
    </div>
</div>

<!-- =========================
   TABS BAR + VIEW TOGGLE
========================== -->
<div class="details-tabs">
    <a class="tab-item @(activeTab=="Overview" ? "is-active" : "")"
       asp-controller="Projects" asp-action="Details" asp-route-id="@Model.Id">Overview</a>

    <a class="tab-item @(activeTab=="Fetch" ? "is-active" : "")"
       asp-controller="Projects" asp-action="Fetch" asp-route-id="@Model.Id">Extract</a>

    <a class="tab-item @(activeTab=="Verify" ? "is-active" : "")"
       asp-controller="Projects" asp-action="Verify" asp-route-id="@Model.Id">Transform</a>

    <a class="tab-item @(activeTab=="Process" ? "is-active" : "")"
       asp-controller="Projects" asp-action="Process" asp-route-id="@Model.Id">Load</a>

    <a class="tab-item @(activeTab=="Config" ? "is-active" : "")"
       asp-controller="Projects" asp-action="Config" asp-route-id="@Model.Id">Config</a>

    <div class="tabs-spacer"></div>
</div>

<div class="verify-page overview-grid">

    <section class="details-main">

        <div>

            <div class="panel">
                <div class="panel-head">
                    <div>
                        <div class="panel-title">Blockers & Failed Rules</div>
                        <div class="panel-sub">Critical issues requiring governance review</div>
                    </div>
                </div>

                <div class="verify-blockers-grid">
                    <div class="verify-blocker-card">
                        <div class="verify-blocker-num">2</div>
                        <div class="verify-blocker-label">Critical Blockers</div>
                    </div>
                    <div class="verify-blocker-detail">
                        <div class="verify-blocker-section">
                            <div class="verify-blocker-subtitle">Top Failing Categories</div>
                            <div class="verify-blocker-chips">
                                <span class="pill pill-fail">Uniqueness</span>
                                <span class="pill pill-fail">Referential Integrity</span>
                                <span class="pill pill-warn">Schema Drift</span>
                            </div>
                        </div>

                        <div class="verify-blocker-section">
                            <div class="verify-blocker-subtitle">Exception Rows Impacted</div>
                            <div class="verify-blocker-impact">18 rows</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel">
               
                <div style="display:flex; align-items:center; justify-content:space-between;">
                    <div>
                        <div class="panel-title">SQL Validation Breakdown</div>
                        <div class="panel-sub">Validation rules executed by category</div>
                    </div>

                    <div style="display:flex; gap:12px;">
                        
                        <button class="btn btn-secondary" type="button" style="display:flex; align-items:center; gap:6px;">
                            <i data-lucide="download"></i> Export
                        </button>
                    </div>
                </div>

                <div class="verify-validation-table">
                    <div class="verify-val-row verify-val-head">
                        <div>Category</div><div>Failed</div><div>Points</div><div>AI Recommendation</div><div>Severity</div><div>Coverage</div><div>Download</div>
                    </div>
                    <div class="verify-val-row">
                        <div class="verify-val-category">Mapping Mismatch</div>
                        <div class="verify-val-bad">3</div>
                        <div class="score-point">+10</div>
                        <div>Our AI can automatically identify and resolve mapping mismatches by aligning the fields in your data with the correct categories. It will ensure all data is correctly matched to the corresponding fields for accurate processing.</div>
                       
                        <div><span class="pill pill-severity-critical">Critical</span></div>
                        <div class="verify-coverage">
                            <div class="verify-coverage-bar"><span style="width: 83%"></span></div>
                            <span class="verify-coverage-text">83%</span>
                        </div>
                        <div> <i data-lucide="download"></i></div>
                    </div>
                    <div class="verify-val-row">
                        <div class="verify-val-category">Rule Conflict</div>
                        
                        <div class="verify-val-bad">2</div>
                        <div class="score-point">+7</div>
                        <div>AI can help detect and resolve conflicts between rules by analyzing the dataset and automatically suggesting the best rule configuration. It will recommend adjustments to prevent conflicts while keeping your data consistent and correct.</div>
                      
                        <div><span class="pill pill-severity-high">High</span></div>
                        <div class="verify-coverage">
                            <div class="verify-coverage-bar"><span style="width: 83%"></span></div>
                            <span class="verify-coverage-text">83%</span>
                        </div>
                        <div> <i data-lucide="download"></i></div>
                    </div>
                    <div class="verify-val-row">
                        <div class="verify-val-category">Lookup Failure</div>
                       
                        <div class="verify-val-bad">2</div>
                        <div class="score-point">+6</div>
                        <div>Our AI can perform advanced lookups to identify the correct data entries and resolve any lookup failures. It can automatically match missing or incorrectly linked data from external sources or internal databases.</div>
                       
                        <div><span class="pill pill-severity-high">High</span></div>
                        <div class="verify-coverage">
                            <div class="verify-coverage-bar"><span style="width: 92%"></span></div>
                            <span class="verify-coverage-text">92%</span>
                        </div>
                        <div> <i data-lucide="download"></i></div>
                    </div>
                    <div class="verify-val-row">
                        <div class="verify-val-category">Aggregation Error</div>
                       
                        <div class="verify-val-good">0</div>
                        <div class="score-point">-</div>
                        <div>AI can analyze your dataset for aggregation errors and recommend corrections by recalculating or restructuring data to ensure accurate summation, averages, or groupings. It will ensure your aggregated results are precise.</div>
                        
                        <div><span class="pill pill-severity-medium">Medium</span></div>
                        <div class="verify-coverage">
                            <div class="verify-coverage-bar"><span style="width: 100%"></span></div>
                            <span class="verify-coverage-text">100%</span>
                        </div>
                        <div> <i data-lucide="download"></i></div>
                    </div>
                    <div class="verify-val-row">
                        <div class="verify-val-category">Join Loss</div>
                       
                        <div class="verify-val-good">0</div>
                        <div class="score-point">-</div>
                        <div>Our AI can automatically identify and restore lost joins in the dataset by cross-referencing related entries and rebuilding the correct relationships between records. This will ensure that no data is left out of the final results.</div>
                        
                        <div><span class="pill pill-severity-medium">Medium</span></div>
                        <div class="verify-coverage">
                            <div class="verify-coverage-bar"><span style="width: 100%"></span></div>
                            <span class="verify-coverage-text">100%</span>
                        </div>
                        <div> <i data-lucide="download"></i></div>
                    </div>
                    <div class="verify-val-row">
                        <div class="verify-val-category">
                            Sequence Dependency
                        </div>
                        
                        <div class="verify-val-good">0</div>
                        <div class="score-point">-</div>
                        <div>AI can detect and correct sequence dependency issues by analyzing the data flow and ensuring all records are processed in the correct order. It can automatically adjust the sequence to maintain data integrity and consistency.</div>
                        
                        <div><span class="pill pill-severity-low">Low</span></div>
                        <div class="verify-coverage">
                            <div class="verify-coverage-bar"><span style="width: 100%"></span></div>
                            <span class="verify-coverage-text">100%</span>
                        </div>
                        <div> <i data-lucide="download"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- RIGHT (Side) -->
    <aside class="overview-side">

        <!-- AI Copilot (Reusable Side Panel) -->
        <div class="panel copilot">
            <div class="copilot-head">
                <div class="copilot-title">
                    <div class="copilot-badge">
                        <i data-lucide="sparkles"></i>
                    </div>
                    <div>
                        <div class="copilot-name">AI Copilot</div>
                        <div class="copilot-sub">Project-aware assistant (assistive only)</div>
                    </div>
                </div>
                <div class="copilot-status">
                    <span class="online-dot"></span> Online
                </div>
            </div>

            <div class="copilot-scope">
                <span class="scope-pill">
                    <i data-lucide="folder"></i>
                    Project scoped
                </span>
                <span class="scope-text">MIG-2026-001 • @Model.SourcePlatform → @Model.TargetPlatform</span>
            </div>

            <div class="copilot-insights">
                <div class="mini-head">
                    <span>AI Insights</span>
                    <span class="mini-tag">Azure AI Foundry</span>
                </div>

                <div class="insight high">
                    <div class="insight-ic"><i data-lucide="alert-octagon"></i></div>
                    <div class="insight-txt">
                        <div class="insight-title">83% of failures</div>
                        <div class="insight-sub">Uniqueness + Referential Integrity patterns</div>
                    </div>
                    <span class="sev high">High</span>
                </div>

                <div class="insight high">
                    <div class="insight-ic"><i data-lucide="link-2"></i></div>
                    <div class="insight-txt">
                        <div class="insight-title">Highest risk object</div>
                        <div class="insight-sub">Contacts → Accounts mapping violations</div>
                    </div>
                    <span class="sev high">High</span>
                </div>

                <div class="insight med">
                    <div class="insight-ic"><i data-lucide="scan"></i></div>
                    <div class="insight-txt">
                        <div class="insight-title">Schema drift detected</div>
                        <div class="insight-sub">Matters transform requires manual review</div>
                    </div>
                    <span class="sev med">Medium</span>
                </div>
            </div>

            <div class="copilot-suggest">
                <div class="mini-head">
                    <span>Suggested Questions</span>
                    <span class="mini-hint">click to ask</span>
                </div>

                <div class="suggest-grid">
                    <button class="suggest-btn" type="button">Why did Contacts fail?</button>
                    <button class="suggest-btn" type="button">Show uniqueness patterns</button>
                    <button class="suggest-btn" type="button">Compare to last run</button>
                    <button class="suggest-btn" type="button">What’s blocking approval?</button>
                </div>
            </div>

            <div class="copilot-chat" id="copilotChat" aria-label="AI chat messages">
                <div class="msg ai">
                    Based on validation, <b>Contacts</b> readiness is <b>68%</b>, driven by
                    <b>missing first/last names</b>. This blocks automation eligibility.
                    <div class="time">2 minutes ago</div>
                </div>

                <div class="msg user">
                    How did we fix this in past migrations?
                    <div class="time">1 minute ago</div>
                </div>

                <div class="msg ai">
                    For similar cases, we’ve improved readiness by:
                    <ul>
                        <li>Re-exporting using <b>Full Contact Report</b></li>
                        <li>Applying name-splitting normalization rules</li>
                        <li>Running duplicate detection before load</li>
                    </ul>
                    <div class="time">just now</div>
                </div>
            </div>

            <div class="copilot-input">
                <input id="copilotInput" type="text" placeholder="Ask about this project…" />
                <button id="copilotSend" type="button" class="send-btn" title="Send">
                    <i data-lucide="send"></i>
                </button>
            </div>

            <div class="copilot-foot">
                <button class="micro-action" type="button">
                    <i data-lucide="wrench"></i> Suggest fix
                </button>
                <button class="micro-action" type="button">
                    <i data-lucide="search"></i> Similar cases
                </button>
                <button class="micro-action" type="button">
                    <i data-lucide="terminal-square"></i> Generate SQL
                </button>
            </div>
        </div>

       

    </aside>


</div>

@section PageStyles {
    <link rel="stylesheet" href="~/css/verify.css" />
    <style>
        .overview-grid {
            display: grid;
            grid-template-columns: 1fr 480px;
            gap: 16px;
        }

        .score-point{
            font-weight: 700;
        }
        body .verify-page .verify-val-row {
            grid-template-columns: 1fr 0.3fr 0.3fr 2fr 0.4fr  1fr 0.5fr;
        }
    </style>
}